<h1>
Сервис обработки гостей. Тестовое задание для bnovo
</h1>

## Стек проекта

Для ведения локальной разработки требуется:
- **Nginx** - веб-сервер
- **PHP**-FPM + CLI (v. 8.2) - интерпретатор языка
- **Postgres** - СУБД для хранения данных

### Настройка проекта
Рекомендуется вести локальную разработку с использованием Docker.

Для запуска приложения и всех зависимостей необходимо выполнить следующие команды:
```shell
docker compose up -d
```
Затем необходимо в контейнере с базой данных создать тестовую БД
```shell
docker exec -it database sh
psql
```
```postgresql
CREATE DATABASE guest_processing_service;
```

Файл [docker-compose.yml](docker-compose.yml) определяет различные контейнеры,
которые работают вместе для создания приложения.
Каждый из этих контейнеров представлен как служба в конфигурации docker-compose.yml.
Контейнер app является основной службой, которая будет запускать приложение.

## Сборка проекта

После разворачивания проекта с помощью Docker необходимо перейти в контейнер
с самим приложением, и также 4 команды для установки зависимостей используя Composer,
генерации ключа, запуска миграций и тестового сидеры гостей.
```shell
docker exec -it app sh
cd guest-processing-service
composer install
php artisan key:generate
php artisan migrate
php artisan db:seed
```

Затем необходимо скопировать файл .env.example в .env
```shell
cp .env.example .env
```

После этого можно отправлять запросы к приложению по домену, который необходимо
добавить в /etc/hosts. Для этого выполните:
```shell
sudo nano /etc/hosts
```
И добавьте следующую строку в ваш файл
```
127.0.0.1       guest-processing-service.test
```

При любых запросов к API сервиса необходимо отправлять API-ключ
для авторизации в заголовке X-API-KEY, ключ сгенерирован автоматически и
находится в файле .env.example в переменной API_KEY.
Ключ является тестовым, механизма его замены и обновления в сервисе не предусмотрено.

## Переменные среды

Переменные среды описаны в файле [.env.example](.env.example), скопируйте файл, переименуйте его в `.env` и внесите необходимые изменения.
Все параметры, которые могут потребоваться, вынесены в `.env.example`.

<details>
    <summary>Описание параметров</summary>

### Обязательные параметры

- `APP_KEY` - Секретный ключ приложения, заполняется командой `php artisan key:generate`
- `APP_URL` - Ссылка на приложение
- `DB_CONNECTION` - Драйвер для подключения к базе данных
- `DB_HOST` - Хост для подключения к базе данных
- `DB_PORT` - Порт для подключения к базе данных
- `DB_DATABASE` - Название базы данных
- `DB_USERNAME` - Имя пользователя в базе данных
- `DB_PASSWORD` - Пароль пользователя в базе данных
- `API_KEY` - API-ключ для авторизации

</details>

## Анализ и стилизация кода

На проекте используется статический анализатор кода <b>PhpStan</b> и инструмент поддержки стилизации кода <b>Pint</b>.

### PhpStan
PHPStan - это инструмент статического анализа кода на PHP, который помогает выявлять потенциальные ошибки, несоответствия типов данных и другие проблемы в PHP-коде еще до его выполнения.

Проверка кода на ошибки:
```shell
./vendor/bin/phpstan
```

<details>
    <summary>Внесение исключений</summary>

    Не рекомендуется вносить изменения в файл phpstan.neon.
    
    Файл phpstan.neon представляет собой конфигурационный файл для PHPStan, 
    который определяет различные параметры анализа, такие как уровень строгости, 
    пути к файлам для анализа и настройки автозагрузки. 
    
    Внесение изменений непосредственно в этот файл может привести 
    к нежелательным последствиям и нарушению работы, 
    а также к более длительному поиску добавленного исключения.
    
    Вместо этого, для настройки PHPStan и внесения исключений 
    рекомендуется использовать аннотации @phpstan-ignore-error или @phpstan-ignore-next-line. 
    
    Это позволит вам временно исключить определенные ошибки или предупреждения для конкретных файлов, 
    классов или методов без необходимости изменения основных конфигурационных файлов.
    
    Использование аннотаций @phpstan-ignore-error и @phpstan-ignore-next-line следует ограничивать и 
    применять только там, где это действительно необходимо из-за особенностей кода или взаимодействия 
    с внешними библиотеками.
</details>

### Pint
Pint - это инструмент для поддержки стилизации кода PHP в проектах Laravel. Он основан на PHP-CS-Fixer и обеспечивает простоту в поддержке чистоты кода.

Исправление стилизации кода:
```shell
./vendor/bin/pint
```

## Техническая документация
Вся техническая документация располагается в папке [docs](docs).

### Информация по API для обращения к сервису

Документирование API производится средствами Swagger/OpenAPI.
В файле [swagger.yaml](docs/swagger.yaml) находится описание запросов к API проекта
